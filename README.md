
ihmc-ors-yarp
=============

**Warning: this library is still in active development, and is not supposed to work at this stage**

The `ihmc-ors-yarp` project provides a bridge to interface YARP-powered robots with the [IHMC-ORS](https://github.com/ihmcrobotics/ihmc-open-robotics-software) software.
In particular `ihmc-ors-yarp` provides the `bridgeIHMCORS` YARP devices, that can be launched through the `yarprobotinterface` to expose YARP controlboards to a controller
implemented using  [IHMC-ORS](https://github.com/ihmcrobotics/ihmc-open-robotics-software).

## Dependencies
ihmc-ors-yarp library depends on
 - [YARP](http://www.yarp.it/)
 - [Asio](https://think-async.com/)
 - [fastcdr](https://github.com/eProsima/Fast-CDR)

Furthermore, `ihmc-ors-yarp` relies on idl messages generated using the `fastrtpsgen` of [fastrtps](https://github.com/eProsima/Fast-RTPS).
However, unless you need to regenerate the message, you will not need `fastrtps` to build `ihmc-ors-yarp`.

## Installation
### Build
```shell
git clone https://github.com/robotology-playground/ihmc-ors-yarp
cd ihmc-ors-yarp
mkdir build
cd build
cmake -DCMAKE_INSTALL_PREFIX=<install_prefix> ..
make
[sudo] make install
```

### Configure your system
To make sure that the `bridgeIHMCORS` YARP device is found, add the `<install_prefix>` that you choose to the `YARP_DATA_DIRS` env variable.

## Usege

### iCub

#### Simulated
We provide a few configuration files to run the device on the iCub Gazebo simulation. in `robots/icubGazeboSim`:
~~~
yarprobotinterface --config launch-bridgeihmcors-sim.xml
~~~
As the `gazebo_yarp_plugins` do no support launching a YARP device inside Gazebo itself, this configuration file connects
the `bridgeIHMCORS` to the controlboards through a group of `remote_controlboard` devices. Clearly this is not ideal, but
it is sufficient to testing. The ideal use of this plugin is to embed it in the `yarprobotinterface` that is running the
controlboard devices exposing the functionalities of the robot.

#### Real Robot
To run the device on the real robot, it should be sufficient to add this line to your `yarprobotinterface` configuration file:
~~~
    <!-- Remapper device that selects a given set of joints -->
    <device name="ihmc_remapped_controlboard" type="controlboardremapper">
         <param name="axesNames">(torso_pitch,torso_roll,torso_yaw,l_shoulder_pitch,l_shoulder_roll,l_shoulder_yaw,l_elbow,r_shoulder_pitch,r_shoulder_roll,r_shoulder_yaw,r_elbow,l_hip_pitch,l_hip_roll,l_hip_yaw,l_knee,l_ankle_pitch,l_ankle_roll,r_hip_pitch,r_hip_roll,r_hip_yaw,r_knee,r_ankle_pitch,r_ankle_roll)</param>

         <action phase="startup" level="10" type="attach">
            <paramlist name="networks">
                <!-- motorcontrol -->
                <elem name="left_leg">left_leg_mc</elem>
                <elem name="right_leg">right_leg_mc</elem>
                <elem name="left_arm">left_arm_mc</elem>
                <elem name="right_arm">right_arm_mc</elem>
                <elem name="torso">torso_mc</elem>
            </paramlist>
         </action>
    </device>

    <!-- actual bridgeIHMCORS device -->
    <device name="ihmc_bridge" type="bridgeIHMCORS">
         <param name="period">0.005</param>

         <action phase="startup" level="20" type="attach">
            <paramlist name="networks">
                <!-- motorcontrol  -->
                <elem name="ihmc_remapped_controlboard">ihmc_remapped_controlboard</elem>
            </paramlist>
         </action>
    </device>
~~~
where the devices passed to the `ihmc_remapped_controlboard` are the actual controlboard devices of your robot (that may have different names) and
the `axesNames` parameter has the list of joints that you want to expose through the `bridgeIHMCORS` device.



## Regenerate the idl messages
To regenerate the idl messages, you need to have the `fastrtpsgen` tool on your PATH, that is part
of [`fastrtps`](https://github.com/eProsima/Fast-RTPS). If you compile `fastrtps` from source, remember
to enable the `BUILD_JAVA` CMake option to compile the `fastrtpsgen` tool.
Once you have `fastrtpsgen` in your PATH,  you can regenerate the autogenerated files in the `autogenerated` directory by executing the `idl-regenerate-cxx` target.
